% Transistor ladder block diagram
% Author: Jaak Jensen

\documentclass{article}

\usepackage{tikz}
\usetikzlibrary{dsp,chains}
\usepackage[margin=0.5in]{geometry} %Set margins using Geometry package

\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it}
\newcommand{\z}{\mathpzc{z}}

\title{Virtual Analog Model of Ladder Filter}
\author{Jaak Jensen}

\date{} %This is blank because we don't want to display a date

\addtolength{\topmargin}{-0.5in}
\addtolength{\textheight}{6in}
\addtolength{\hoffset}{-0.1in}

\begin{document}

\maketitle

% SVF block diagram
\begin{figure} [ht] %Place at top of page in-line with text
\begin{center}
\begin{tikzpicture}

	% Place nodes using a matrix
	\matrix[row sep=2.5mm, column sep=5mm]
	{
		%--------------------------------------------------------------------
		\node[coordinate] 		   (m00) {};          &
		\node[coordinate]                  (m01) {};          &
		\node[coordinate]                  (m02) {};          &
		\node[coordinate]                  (m03) {};          &
		\node[dspnodeopen,dsp/label=above]                  (m04) {$Y_{HP}$};          &
		\node[coordinate]                  (m05) {};          &
		\node[coordinate]                  (m06) {};          &
		\node[coordinate]                  (m07) {};          &
		\node[dspnodeopen,dsp/label=above]                  (m08) {$Y_{BP}$};          &
		\node[coordinate]                  (m09) {};          &
		\node[coordinate]                  (m0X) {};          &
		\node[coordinate]                 (m0X1) {};        &
		\node[coordinate]                  (m0X2) {};          &
		\node[coordinate]                  (m0X3) {};          &
		\node[coordinate]                 (m0X4) {};        &
		\node[coordinate]                  (m0X5) {};          &
		\node[coordinate]                  (m0X6) {};          &
		\node[coordinate]                 (m0X7) {};        &
		\node[coordinate]                  (m0X8) {};          &
		\node[coordinate]                  (m0X9) {};          &
		\node[coordinate]                 (m0XX) {};        &
		\node[coordinate]                  (m0XX1) {};          &
		\node[coordinate]                  (m0XX2) {};        \\
		%--------------------------------------------------------------------
		\\
		%--------------------------------------------------------------------
		\node[dspnodeopen,dsp/label=above] (m10) {$X_{IN}$};          &
		\node[coordinate]                  (m11) {};          &
		\node[dspadder,label={below left:$-$},label={below right:$-$}]                    (m12) {};          &
		\node[dspmixer,dsp/label=above]                     (m13) {$\alpha_{0}$};          &
		\node[dspnodefull]                 (m14) {};          &
		\node[dspmixer,dsp/label=above]                     (m15) {$\alpha$};          &
		\node[dspnodefull]                 (m16) {};          &
		\node[dspadder]                     (m17) {};          &
		\node[dspnodefull]                  (m18) {};          &
		\node[dspmixer,dsp/label=above]                     (m19) {$\alpha$};          &
		\node[dspnodefull]                 (m1X) {};          &
		\node[dspadder]                     (m1X1) {};          &
		\node[dspnodefull]                  (m1X2) {};          &
		\node[dspmixer,dsp/label=above]                     (m1X3) {$\alpha$};          &
		\node[dspnodefull]                 (m1X4) {};          &
		\node[dspadder]                     (m1X5) {};          &
		\node[dspnodefull]                  (m1X6) {};          &
		\node[dspmixer,dsp/label=above]                     (m1X7) {$\alpha$};          &
		\node[dspnodefull]                 (m1X8) {};          &
		\node[dspadder]                     (m1X9) {};          &
		\node[dspnodefull]                  (m1XX) {};          &
		\node[dspnodeopen,dsp/label=above] (m1XX1) {$Y_{LP}$};    \\
		%--------------------------------------------------------------------
		\node[coordinate]		   (m20) {};          &
		\node[coordinate]                  (m21) {};          &
		\node[coordinate]                  (m22) {};          &
		\node[coordinate]                  (m23) {};          &
		\node[coordinate]                  (m24) {};          &
		\node[dspmixer,dsp/label=below]                  (m25) {$\rho$};          &
		\node[coordinate]                  (m26) {};          &
		\node[dspnodefull]                  (m27) {};          &
		\node[coordinate]                  (m28) {};          &
		\node[coordinate]                  (m29) {};          &
		\node[coordinate]                  (m2X) {};          &
		\node[dspnodefull]                  (m2X1) {};          &
		\node[coordinate]                  (m2X2) {};          &
		\node[coordinate]                  (m2X3) {};          &
		\node[coordinate] 		   (m2X4) {};           &
		\node[coordinate]                  (m2X5) {};          &
		\node[coordinate]                  (m2X6) {};          &
		\node[coordinate]                 (m2X7) {};        &
		\node[coordinate]                  (m2X8) {};          &
		\node[coordinate]                  (m2X9) {};          &
		\node[coordinate]                 (m2XX) {};        &
		\node[coordinate]                  (m2XX1) {};          &
		\node[coordinate]                  (m2XX2) {};        \\				
		%--------------------------------------------------------------------
		\node[coordinate]		   (m30) {};          &
		\node[coordinate]                  (m31) {};          &
		\node[coordinate]                  (m32) {};          &
		\node[coordinate]                  (m33) {};          &
		\node[coordinate]                  (m34) {};          &
		\node[coordinate]                  (m35) {};          &
		\node[coordinate]                  (m36) {};          &
		\node[dspsquare]                   (m37) {$\z^{-1}$}; &
		\node[coordinate]                  (m38) {};          &
		\node[coordinate]                  (m39) {};          &
		\node[coordinate]                  (m3X) {};          &
		\node[dspsquare]                   (m3X1) {$\z^{-1}$}; &
		\node[coordinate]                  (m3X2) {};          &
		\node[coordinate] 		   (m3X3) {};           &
		\node[coordinate] 		   (m3X4) {};           &
		\node[dspsquare]                   (m3X5) {$\z^{-1}$}; &
		\node[coordinate]                  (m3X6) {};          &
		\node[coordinate]                 (m3X7) {};        &
		\node[coordinate]                  (m3X8) {};          &
		\node[dspsquare]                   (m3X9) {$\z^{-1}$}; &
		\node[coordinate]                 (m3XX) {};        &

		\node[coordinate]                  (m3XX1) {};          &
		\node[coordinate]                  (m3XX2) {};        \\	
		%--------------------------------------------------------------------
		\\
		%--------------------------------------------------------------------
		\node[coordinate]		   (m40) {};          &
		\node[coordinate]                  (m41) {};          &
		\node[coordinate]                  (m42) {};          &
		\node[coordinate]                  (m43) {};          &
		\node[coordinate]                  (m44) {};          &
		\node[coordinate]                  (m45) {};          &
		\node[coordinate]                  (m46) {};          &
		\node[dspadder]                   (m47) {}; &
		\node[coordinate]                  (m48) {};          &
		\node[coordinate]                  (m49) {};          &
		\node[coordinate]                  (m4X) {};          &
		\node[dspadder]                   (m4X1) {}; &
		\node[coordinate]                 (m4X2) {};          &
		\node[coordinate] 		   (m4X3) {};           &
		\node[coordinate] 		   (m4X4) {};           &
		\node[coordinate]                  (m4X5) {};          &
		\node[coordinate]                  (m4X6) {};          &
		\node[coordinate]                 (m4X7) {};        &
		\node[coordinate]                  (m4X8) {};          &
		\node[coordinate]                  (m4X9) {};          &
		\node[coordinate]                 (m4XX) {};        &
		\node[coordinate]                  (m4XX1) {};          &
		\node[coordinate]                  (m4XX2) {};        \\	
		%--------------------------------------------------------------------
		\node[coordinate]		   (m50) {};          &
		\node[coordinate]                  (m51) {};          &
		\node[coordinate]                  (m52) {};          &
		\node[coordinate]                  (m53) {};          &
		\node[coordinate]                  (m54) {};          &
		\node[coordinate]                  (m55) {};          &
		\node[coordinate]                  (m56) {};          &
		\node[coordinate]                  (m57) {};          &
		\node[coordinate]                  (m58) {};          &
		\node[coordinate]                  (m59) {};          &
		\node[coordinate]                  (m5X) {};          &
		\node[coordinate]                  (m5X1) {};          &
		\node[coordinate]                  (m5X2) {};          &
		\node[coordinate]                  (m5X3) {};          &
		\node[coordinate] 		   (m5X4) {};           &
		\node[coordinate]                  (m5X5) {};          &
		\node[coordinate]                  (m5X6) {};          &
		\node[coordinate]                 (m5X7) {};        &
		\node[coordinate]                  (m5X8) {};          &
		\node[coordinate]                  (m5X9) {};          &
		\node[coordinate]                 (m5XX) {};        &
		\node[coordinate]                  (m5XX1) {};          &
		\node[coordinate]                  (m5XX2) {};        \\	
		%--------------------------------------------------------------------
	};

	% Draw connections
	\begin{scope}[start chain]
		\chainin (m10);
		\chainin (m12) [join=by dspconn];
		\chainin (m13) [join=by dspconn];
		\chainin (m14) [join=by dspconn];
		\chainin (m04) [join=by dspconn];		%Add arrow up to Yhp
		\chainin (m14);
		\chainin (m15) [join=by dspconn];
		\chainin (m16) [join=by dspconn];
		\chainin (m17) [join=by dspconn];
		\chainin (m18) [join=by dspconn];
		\chainin (m08) [join=by dspconn]; 	%Add arrow up to Ybp
		\chainin (m18);
		\chainin (m19) [join=by dspconn];
		\chainin (m1X) [join=by dspconn];
		\chainin (m1X1) [join=by dspconn];
		\chainin (m1X2) [join=by dspconn];
		\chainin (m1X3) [join=by dspconn];
		\chainin (m1X4) [join=by dspconn];
		\chainin (m1X5) [join=by dspconn];
		\chainin (m1X6) [join=by dspconn];
		\chainin (m1X7) [join=by dspconn];
		\chainin (m1X8) [join=by dspconn];
		\chainin (m1X9) [join=by dspconn];
		\chainin (m1XX) [join=by dspconn];
		\chainin (m1XX1) [join=by dspconn];
	\end{scope}

	%Trapezoidal integrator 1
	\begin{scope}[start chain]
		\chainin (m16);
		\chainin (m46) [join=by dspline];
		\chainin (m47) [join=by dspconn];
		\chainin (m18);
		\chainin (m48) [join=by dspline];
		\chainin (m47) [join=by dspconn];
		\chainin (m37) [join=by dspconn];
		\chainin (m17) [join=by dspconn];
	\end{scope}

	%Trapezoidal integrator 2
	\begin{scope}[start chain]
		\chainin (m1X);
		\chainin (m4X) [join=by dspline];
		\chainin (m4X1) [join=by dspconn];
		\chainin (m1X2);
		\chainin (m4X2) [join=by dspline];
		\chainin (m4X1) [join=by dspconn];
		\chainin (m3X1) [join=by dspconn];
		\chainin (m1X1) [join=by dspconn];
	\end{scope}

	%Trapezoidal integrator 3
	\begin{scope}[start chain]
		\chainin (m1X4);
		\chainin (m4X4) [join=by dspline];
		\chainin (m4X5) [join=by dspconn];
		\chainin (m1X6);
		\chainin (m4X6) [join=by dspline];
		\chainin (m4X5) [join=by dspconn];
		\chainin (m3X5) [join=by dspconn];
		\chainin (m1X5) [join=by dspconn];
	\end{scope}

	%Trapezoidal integrator 4
	\begin{scope}[start chain]
		\chainin (m1X8);
		\chainin (m4X8) [join=by dspline];
		\chainin (m4X9) [join=by dspconn];
		\chainin (m1XX);
		\chainin (m4XX) [join=by dspline];
		\chainin (m4X9) [join=by dspconn];
		\chainin (m3X9) [join=by dspconn];
		\chainin (m1X9) [join=by dspconn];
	\end{scope}

	%Feedback paths
	\begin{scope}[start chain]
		\chainin (m27);	%Feedback from integrator 1
		\chainin (m25) [join=by dspconn];
		\chainin (m12) [join=by dspconn];
		\chainin (m2X1);	%Feedback from integrator 2
		\chainin (m29) [join=by dspline];
		\chainin (m59) [join=by dspline];
		\chainin (m52) [join=by dspline];
		\chainin (m12) [join=by dspconn];
	\end{scope}


\end{tikzpicture}
\caption{Digital Block Diagram of Transistor Ladder Filter}
\end{center}
\end{figure}
\end{document}

